<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&D Character Sheet - English/Nepali</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash/4.17.21/lodash.min.js"></script>
    <style>
        .character-image {
            width: 200px;
            height: 200px;
            border: 2px dashed #ccc;
            margin: 10px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .character-image img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        .equipment-section, .description-section {
            resize: vertical;
            min-height: 100px;
            width: 100%;
            font-family: Arial, sans-serif;
            padding: 10px;
        }
        .image-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .generate-btn {
            background-color: #6a5acd;
        }
        .loading {
            opacity: 0.5;
            pointer-events: none;
        }
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .section {
            border: 1px solid #ccc;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        .field {
            margin-bottom: 10px;
        }
        .label {
            display: block;
            margin-bottom: 5px;
        }
        .nepali {
            color: #666;
            font-style: italic;
        }
        input, select {
            width: 100%;
            padding: 5px;
            margin-bottom: 10px;
        }
        .ability-scores {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }
        .ability-score {
            text-align: center;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <h1>D&D Character Sheet / डी एंड डी क्यारेक्टर सीट</h1>
    
    <div class="section">
        <h2>Basic Information / आधारभूत जानकारी</h2>
        <div class="field">
            <label class="label">
                Character Name / पात्रको नाम:
                <input type="text" id="characterName">
            </label>
        </div>
        <div class="field">
            <label class="label">
                Race / जाति:
                <select id="race">
                    <option value="elf">Elf / एल्फ</option>
                    <option value="dwarf">Dwarf / पुड्को</option>
                    <option value="human">Human / मानव</option>
                    <option value="faerie">Faerie / परी</option>
                    <option value="halfling">Halfling / हाफलिङ</option>
                </select>
            </label>
        </div>
        <div class="field">
            <label class="label">
                Gender / लिङ्ग:
                <select id="gender">
                    <option value="male">Male / पुरुष</option>
                    <option value="female">Female / महिला</option>
                    <option value="non-binary">Non-binary / गैर-बाइनरी</option>
                </select>
            </label>
        </div>
        <div class="field">
            <label class="label">
                Class / वर्ग:
                <select id="class">
                    <option value="barbarian">Barbarian / बर्बेरियन</option>
                    <option value="bard">Bard / बार्ड</option>
                    <option value="cleric">Cleric / क्लेरिक</option>
                    <option value="druid">Druid / द्रुइड</option>
                    <option value="fighter">Fighter / फाइटर</option>
                    <option value="monk">Monk / भिक्षु</option>
                    <option value="paladin">Paladin / प्यालाडिन</option>
                    <option value="ranger">Ranger / रेन्जर</option>
                    <option value="rogue">Rogue / रोग</option>
                    <option value="sorcerer">Sorcerer / जादूगर</option>
                    <option value="warlock">Warlock / वारलक</option>
                    <option value="wizard">Wizard / विज़र्ड</option>
                </select>
            </label>
        </div>
        <div class="field">
            <label class="label">
                Level / स्तर:
                <input type="number" id="level" min="1" max="20" value="1">
            </label>
        </div>
    </div>

    <div class="section">
        <h2>Ability Scores / क्षमता स्कोर</h2>
        <div class="ability-scores">
            <div class="ability-score">
                <label class="label">
                    Strength / बल
                    <input type="number" id="strength" min="1" max="20" value="10">
                </label>
            </div>
            <div class="ability-score">
                <label class="label">
                    Dexterity / चतुर्य
                    <input type="number" id="dexterity" min="1" max="20" value="10">
                </label>
            </div>
            <div class="ability-score">
                <label class="label">
                    Constitution / संविधान
                    <input type="number" id="constitution" min="1" max="20" value="10">
                </label>
            </div>
            <div class="ability-score">
                <label class="label">
                    Intelligence / बुद्धि
                    <input type="number" id="intelligence" min="1" max="20" value="10">
                </label>
            </div>
            <div class="ability-score">
                <label class="label">
                    Wisdom / ज्ञान
                    <input type="number" id="wisdom" min="1" max="20" value="10">
                </label>
            </div>
            <div class="ability-score">
                <label class="label">
                    Charisma / करिश्मा
                    <input type="number" id="charisma" min="1" max="20" value="10">
                </label>
            </div>
        </div>
    </div>

    <div class="section">
        <h2>Combat Stats / युद्ध तथ्यांक</h2>
        <div class="field">
            <label class="label">
                Hit Points / हिट पोइन्ट्स:
                <input type="number" id="hitPoints" min="1" value="10">
            </label>
        </div>
        <div class="field">
            <label class="label">
                Armor Class / कवच वर्ग:
                <input type="number" id="armorClass" min="1" value="10">
            </label>
        </div>
        <div class="field">
            <label class="label">
                Initiative / पहल:
                <input type="number" id="initiative" value="0">
            </label>
        </div>
    </div>

    <div class="section">
        <h2>Character Description / पात्र विवरण</h2>
        <textarea id="characterDescription" class="description-section" placeholder="Describe your character's appearance, personality, and background / तपाईंको पात्रको रूप, व्यक्तित्व र पृष्ठभूमि वर्णन गर्नुहोस्"></textarea>
    </div>

    <div class="section">
        <h2>Character Image / पात्र चित्र</h2>
        <div class="image-buttons">
            <button onclick="generateAIImage()" class="generate-btn">Generate AI Image / एआई चित्र सिर्जना गर्नुहोस्</button>
        </div>
        <div class="character-image" id="characterImageContainer" onclick="document.getElementById('imageInput').click()">
            <input type="file" id="imageInput" accept="image/*" style="display: none" onchange="handleImageUpload(event)">
            <span id="imagePrompt">Click to add character image / चित्र थप्न क्लिक गर्नुहोस्</span>
        </div>
    </div>

    <div class="section">
        <h2>Equipment / उपकरण</h2>
        <textarea id="equipment" class="equipment-section" placeholder="List your equipment here / तपाईंको उपकरणहरू यहाँ सूचीबद्ध गर्नुहोस्"></textarea>
    </div>

    <div class="buttons">
        <button onclick="generateRandomCharacter()" class="generate-btn">Generate Random Character / यादृच्छिक पात्र सिर्जना गर्नुहोस्</button>
        <button onclick="saveCharacter()">Save Character / पात्र सेभ गर्नुहोस्</button>
        <button onclick="loadCharacter()">Load Character / पात्र लोड गर्नुहोस्</button>
    </div>

    <script>
                async function generateAIImage() {
            const description = document.getElementById('characterDescription').value;
            const race = document.getElementById('race').value;
            const characterClass = document.getElementById('class').value;
            
            if (!description) {
                alert('Please add a character description first! / पहिले पात्र विवरण थप्नुहोस्!');
                return;
            }

            const container = document.getElementById('characterImageContainer');
            const generateBtn = document.querySelector('.generate-btn');
            container.classList.add('loading');
            generateBtn.disabled = true;

            try {
                const prompt = `A highly detailed fantasy character portrait. ${race} ${characterClass} ${gender}, wearing ${equipment}. ${description}. Digital painting, detailed face, professional fantasy art, trending on artstation, masterpiece quality.`;
                
                const response = await fetch('https://api.stability.ai/v1/generation/stable-diffusion-xl-1024-v1-0/text-to-image', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer YOUR_API_KEY', // Replace with actual API key
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        text_prompts: [
                            {
                                text: prompt,
                                weight: 1
                            }
                        ],
                        cfg_scale: 7,
                        height: 1024,
                        width: 1024,
                        samples: 1,
                        steps: 30,
                    })
                });

                if (!response.ok) {
                    throw new Error('Image generation failed');
                }

                const result = await response.json();
                const imageBase64 = result.artifacts[0].base64;
                const imageUrl = `data:image/png;base64,${imageBase64}`;
                
                container.innerHTML = `<img src="${imageUrl}" alt="Generated Character Image">`;
                localStorage.setItem('characterImage', imageUrl);
            } catch (error) {
                console.error('Error generating image:', error);
                alert('Failed to generate image. Please try again later. / चित्र सिर्जना गर्न असफल भयो। कृपया पछि पुन: प्रयास गर्नुहोस्।');
            } finally {
                container.classList.remove('loading');
                generateBtn.disabled = false;
            }
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const container = document.getElementById('characterImageContainer');
                    container.innerHTML = `<img src="${e.target.result}" alt="Character Image">`;
                    localStorage.setItem('characterImage', e.target.result);
                };
                reader.readAsDataURL(file);
            }
        }

        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function rollAbilityScore() {
            // Roll 4d6, drop lowest
            const rolls = Array.from({length: 4}, () => getRandomInt(1, 6));
            rolls.sort((a, b) => b - a);
            return rolls.slice(0, 3).reduce((sum, roll) => sum + roll, 0);
        }

        function getModifier(score) {
            return Math.floor((score - 10) / 2);
        }

        function calculateHP(characterClass, level, constitutionMod) {
            const hitDice = {
                'barbarian': 12,
                'fighter': 10,
                'paladin': 10,
                'ranger': 10,
                'monk': 8,
                'rogue': 8,
                'bard': 8,
                'cleric': 8,
                'druid': 8,
                'warlock': 8,
                'sorcerer': 6,
                'wizard': 6
            };
            
            const baseHP = hitDice[characterClass];
            // First level gets maximum HP
            return baseHP + constitutionMod + 
                   ((level - 1) * (Math.floor(baseHP/2) + 1 + constitutionMod));
        }

        function calculateAC(characterClass, dexterityMod) {
            // Basic AC calculation - this could be more complex based on class features
            const baseAC = 10;
            return baseAC + dexterityMod;
        }

        function generateRandomCharacter() {
            // Generate random race
            const races = ['elf', 'dwarf', 'human', 'faerie', 'halfling'];
            const randomRace = races[Math.floor(Math.random() * races.length)];
            
            // Generate random class
            const classes = ['barbarian', 'bard', 'cleric', 'druid', 'fighter', 'monk', 
                           'paladin', 'ranger', 'rogue', 'sorcerer', 'warlock', 'wizard'];
            const randomClass = classes[Math.floor(Math.random() * classes.length)];

            // Generate random gender
            const genders = ['male', 'female', 'non-binary'];
            const randomGender = genders[Math.floor(Math.random() * genders.length)];

            // Generate random level (1-20)
            const level = getRandomInt(1, 20);

            // Generate ability scores
            const strength = rollAbilityScore();
            const dexterity = rollAbilityScore();
            const constitution = rollAbilityScore();
            const intelligence = rollAbilityScore();
            const wisdom = rollAbilityScore();
            const charisma = rollAbilityScore();

            // Calculate derived stats
            const constitutionMod = getModifier(constitution);
            const dexterityMod = getModifier(dexterity);
            
            const hp = calculateHP(randomClass, level, constitutionMod);
            const ac = calculateAC(randomClass, dexterityMod);
            const initiative = dexterityMod;

            // Update form fields
            document.getElementById('race').value = randomRace;
            document.getElementById('class').value = randomClass;
            document.getElementById('gender').value = randomGender;
            document.getElementById('level').value = level;
            document.getElementById('strength').value = strength;
            document.getElementById('dexterity').value = dexterity;
            document.getElementById('constitution').value = constitution;
            document.getElementById('intelligence').value = intelligence;
            document.getElementById('wisdom').value = wisdom;
            document.getElementById('charisma').value = charisma;
            document.getElementById('hitPoints').value = hp;
            document.getElementById('armorClass').value = ac;
            document.getElementById('initiative').value = initiative;
        }

        function saveCharacter() {
            const character = {
                race: document.getElementById('race').value,
                gender: document.getElementById('gender').value,
                name: document.getElementById('characterName').value,
                class: document.getElementById('class').value,
                level: document.getElementById('level').value,
                strength: document.getElementById('strength').value,
                dexterity: document.getElementById('dexterity').value,
                constitution: document.getElementById('constitution').value,
                intelligence: document.getElementById('intelligence').value,
                wisdom: document.getElementById('wisdom').value,
                charisma: document.getElementById('charisma').value,
                hitPoints: document.getElementById('hitPoints').value,
                armorClass: document.getElementById('armorClass').value,
                initiative: document.getElementById('initiative').value,
                equipment: document.getElementById('equipment').value,
                characterDescription: document.getElementById('characterDescription').value
            };

            const characterString = JSON.stringify(character);
            localStorage.setItem('dndCharacter', characterString);
            alert('Character saved! / पात्र सेभ गरियो!');
        }

        function loadCharacter() {
            const characterString = localStorage.getItem('dndCharacter');
            if (!characterString) {
                alert('No saved character found! / सेभ गरिएको पात्र फेला परेन!');
                return;
            }

            const character = JSON.parse(characterString);
            document.getElementById('characterName').value = character.name;
            document.getElementById('class').value = character.class;
            document.getElementById('level').value = character.level;
            document.getElementById('strength').value = character.strength;
            document.getElementById('dexterity').value = character.dexterity;
            document.getElementById('constitution').value = character.constitution;
            document.getElementById('intelligence').value = character.intelligence;
            document.getElementById('wisdom').value = character.wisdom;
            document.getElementById('charisma').value = character.charisma;
            document.getElementById('hitPoints').value = character.hitPoints;
            document.getElementById('armorClass').value = character.armorClass;
            document.getElementById('initiative').value = character.initiative;
            document.getElementById('equipment').value = character.equipment;
            document.getElementById('race').value = character.race;
            document.getElementById('characterDescription').value = character.characterDescription;

            // Load character image if it exists
            const savedImage = localStorage.getItem('characterImage');
            if (savedImage) {
                const container = document.getElementById('characterImageContainer');
                container.innerHTML = `<img src="${savedImage}" alt="Character Image">`;
            }

            alert('Character loaded! / पात्र लोड गरियो!');
        }
    </script>
</body>
</html>